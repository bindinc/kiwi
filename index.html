<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klantenservice Portal - Magazine Abonnementen</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üìû Klantenservice Portal</h1>
                <div class="header-right">
                    <div class="user-info">
                        <span class="agent-name">Agent: <strong id="agentName">Jan Vos</strong></span>
                        <span class="time" id="currentTime"></span>
                    </div>
                    <button id="endSessionBtn" class="btn-end-session-header" onclick="endSession()" title="Be√´indig deze sessie en start opnieuw" style="display: none;">
                        ‚úï Sessie Afsluiten
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Left Panel: Search & Actions -->
            <aside class="left-panel">
                <!-- Quick Search -->
                <section class="card search-card">
                    <h2>üîç Klant Zoeken</h2>
                    <div class="search-form">
                        <div class="form-group">
                            <label for="searchName">Naam</label>
                            <input type="text" id="searchName" placeholder="Achternaam, Voornaam" onkeypress="handleSearchKeyPress(event)">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="searchPostalCode">Postcode</label>
                                <input type="text" id="searchPostalCode" placeholder="1234AB" onkeypress="handleSearchKeyPress(event)">
                            </div>
                            <div class="form-group">
                                <label for="searchHouseNumber">Huisnr.</label>
                                <input type="text" id="searchHouseNumber" placeholder="12" onkeypress="handleSearchKeyPress(event)">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="searchCustomer()">
                            <span>Zoeken</span>
                        </button>
                    </div>

                    <!-- Search Results -->
                    <div id="searchResults" class="search-results" style="display: none;">
                        <h3>Resultaten</h3>
                        <div id="resultsContainer"></div>
                    </div>
                </section>

                <!-- Quick Actions -->
                <section class="card actions-card">
                    <h2>‚ö° Snelle Acties</h2>
                    <button class="btn btn-action" onclick="showNewSubscription()">
                        <span>‚ûï Nieuw Abonnement</span>
                    </button>
                </section>
            </aside>

            <!-- Center Panel: Customer Details & Forms -->
            <main class="center-panel">
                <!-- Welcome Message -->
                <div id="welcomeMessage" class="welcome-message">
                    <div class="empty-state">
                        <span class="empty-icon">üë§</span>
                        <h2>Welkom bij Klantenservice</h2>
                        <p>Zoek een klant of start een nieuwe actie</p>
                    </div>
                </div>

                <!-- Customer Detail View -->
                <div id="customerDetail" class="customer-detail" style="display: none;">
                    <div class="card">
                        <div class="customer-header">
                            <div class="customer-info">
                                <h2 id="customerName"></h2>
                                <p class="customer-meta">
                                    <span id="customerAddress"></span> ‚Ä¢ 
                                    <span id="customerEmail"></span> ‚Ä¢ 
                                    <span id="customerPhone"></span>
                                </p>
                            </div>
                            <div class="customer-actions">
                                <button class="btn btn-small" onclick="editCustomer()">‚úèÔ∏è Bewerken</button>
                                <button id="resendMagazineBtn" class="btn btn-small btn-action-inline" onclick="showResendMagazine()">üìÆ Editie Verzenden</button>
                                <button id="winbackFlowBtn" class="btn btn-small btn-action-inline" onclick="showWinbackFlow()">üéØ Winback</button>
                            </div>
                        </div>

                        <!-- Subscription Overview -->
                        <div class="subscriptions-section">
                            <h3>üì∞ Abonnementen</h3>
                            <div id="subscriptionsList" class="subscriptions-list"></div>
                        </div>
                    </div>
                </div>

                <!-- New Subscription Form -->
                <div id="newSubscriptionForm" class="form-container" style="display: none;">
                    <div class="card onepager-container">
                        <div class="form-header">
                            <h2>‚ûï Nieuw Abonnement Aanmaken</h2>
                            <button class="btn-close" onclick="closeForm('newSubscriptionForm')">‚úï</button>
                        </div>
                        <form id="subscriptionForm" class="form-section" onsubmit="createSubscription(event)">
                            <h3 class="form-subtitle">Aanhef *</h3>
                            <div class="aanhef-row">
                                <label><input type="radio" name="subSalutation" value="Dhr." required checked> Dhr.</label>
                                <label><input type="radio" name="subSalutation" value="Mevr."> Mevr.</label>
                                <label><input type="radio" name="subSalutation" value="Anders"> Anders</label>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="subInitials" placeholder="Voorletters*" required>
                                <input type="text" id="subMiddleName" placeholder="Tussenvoegsel">
                                <input type="text" id="subLastName" placeholder="Achternaam*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="subPostalCode" placeholder="Postcode*" pattern="^[1-9][0-9]{3}[a-zA-Z]{2}$" title="Voer een geldige postcode in (bijv. 1234AB)" required>
                                <input type="text" id="subHouseNumber" placeholder="Huisnr. (en letter)*" maxlength="7" pattern="^[1-9][0-9]{0,5}[A-Z]?$" title="Voer een geldig huisnummer in (bijv. 123 of 123A)" required>
                                <input type="text" id="subHouseExt" placeholder="Toevoeging" maxlength="10">
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="subAddress" placeholder="Straat*" required>
                                <input type="text" id="subCity" placeholder="Plaats*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="tel" id="subPhone" placeholder="Telefoonnummer">
                                <input type="email" id="subEmail" placeholder="E-mailadres*" required>
                            </div>
                            
                            <h3 class="form-subtitle">Abonnementsgegevens</h3>
                            <div class="form-row">
                                <select id="subMagazine" required>
                                    <option value="">Selecteer magazine...</option>
                                    <option value="Avrobode">Avrobode</option>
                                    <option value="Mikrogids">Mikrogids</option>
                                    <option value="Ncrvgids">Ncrvgids</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <select id="subDuration" required>
                                    <option value="">Selecteer duur & betaling...</option>
                                    <optgroup label="Jaarlijks Betaald">
                                        <option value="1-jaar">1 jaar - ‚Ç¨52,00 per jaar</option>
                                        <option value="2-jaar">2 jaar - ‚Ç¨98,00 totaal (5% korting)</option>
                                        <option value="3-jaar">3 jaar - ‚Ç¨140,00 totaal (10% korting)</option>
                                    </optgroup>
                                    <optgroup label="Maandelijks Betaald">
                                        <option value="1-jaar-maandelijks">1 jaar - ‚Ç¨4,50 per maand (‚Ç¨54,00 totaal)</option>
                                        <option value="2-jaar-maandelijks">2 jaar - ‚Ç¨4,35 per maand (‚Ç¨104,40 totaal)</option>
                                        <option value="3-jaar-maandelijks">3 jaar - ‚Ç¨4,20 per maand (‚Ç¨151,20 totaal)</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <input type="date" id="subStartDate" required>
                            </div>
                            
                            <h3 class="form-subtitle">Betaalmethode *</h3>
                            <div class="form-row">
                                <div class="payment-methods">
                                    <div class="payment-option">
                                        <input type="radio" id="subPaymentAuto" name="subPayment" value="automatisch" checked>
                                        <label for="subPaymentAuto">
                                            <span class="payment-icon">
                                                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" fill="none">
                                                    <rect x="3" y="5" width="18" height="14" rx="2" stroke-width="2"/>
                                                    <line x1="3" y1="10" x2="21" y2="10" stroke-width="2"/>
                                                </svg>
                                            </span>
                                            <span class="payment-text">Automatisch incasso</span>
                                        </label>
                                        <div class="additional-input">
                                            <input type="text" id="subIBAN" placeholder="IBAN rekeningnummer" 
                                                pattern="^(NL[0-9]{2}[A-Z]{4}[0-9]{10}|BE[0-9]{2}[0-9]{12})$" 
                                                title="Vul hier een geldig IBAN nummer in. Alleen Nederlandse (NL) en Belgische (BE) rekeningen worden ondersteund.">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h3 class="form-subtitle">Marketing voorkeuren</h3>
                            <div class="optin-row">
                                <label class="optin-label">E-mail contact:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="subOptinEmail" value="yes" checked> Ja</label>
                                    <label><input type="radio" name="subOptinEmail" value="no"> Nee</label>
                                </div>
                            </div>
                            <div class="optin-row">
                                <label class="optin-label">Telefonisch contact:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="subOptinPhone" value="yes" checked> Ja</label>
                                    <label><input type="radio" name="subOptinPhone" value="no"> Nee</label>
                                </div>
                            </div>
                            <div class="optin-row">
                                <label class="optin-label">Direct marketing:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="subOptinPost" value="yes" checked> Ja</label>
                                    <label><input type="radio" name="subOptinPost" value="no"> Nee</label>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('newSubscriptionForm')">Annuleren</button>
                                <button type="submit" class="btn btn-primary">Abonnement Aanmaken</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Edit Customer Form -->
                <div id="editCustomerForm" class="form-container" style="display: none;">
                    <div class="card onepager-container">
                        <div class="form-header">
                            <h2>‚úèÔ∏è Klantgegevens Bewerken</h2>
                            <button class="btn-close" onclick="closeForm('editCustomerForm')">‚úï</button>
                        </div>
                        <form id="customerEditForm" class="form-section" onsubmit="saveCustomerEdit(event)">
                            <input type="hidden" id="editCustomerId">
                            
                            <h3 class="form-subtitle">Aanhef *</h3>
                            <div class="aanhef-row">
                                <label><input type="radio" name="editSalutation" value="Dhr." required> Dhr.</label>
                                <label><input type="radio" name="editSalutation" value="Mevr."> Mevr.</label>
                                <label><input type="radio" name="editSalutation" value="Anders"> Anders</label>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="editInitials" placeholder="Voorletters*" required>
                                <input type="text" id="editMiddleName" placeholder="Tussenvoegsel">
                                <input type="text" id="editLastName" placeholder="Achternaam*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="editPostalCode" placeholder="Postcode*" pattern="^[1-9][0-9]{3}[a-zA-Z]{2}$" title="Voer een geldige postcode in (bijv. 1234AB)" required>
                                <input type="text" id="editHouseNumber" placeholder="Huisnr. (en letter)*" maxlength="7" pattern="^[1-9][0-9]{0,5}[A-Z]?$" title="Voer een geldig huisnummer in" required>
                                <input type="text" id="editHouseExt" placeholder="Toevoeging" maxlength="10">
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="editAddress" placeholder="Straat*" required>
                                <input type="text" id="editCity" placeholder="Plaats*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="tel" id="editPhone" placeholder="Telefoonnummer">
                                <input type="email" id="editEmail" placeholder="E-mailadres*" required>
                            </div>
                            
                            <h3 class="form-subtitle">Marketing voorkeuren</h3>
                            <div class="optin-row">
                                <label class="optin-label">E-mail contact:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="editOptinEmail" value="yes"> Ja</label>
                                    <label><input type="radio" name="editOptinEmail" value="no"> Nee</label>
                                </div>
                            </div>
                            <div class="optin-row">
                                <label class="optin-label">Telefonisch contact:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="editOptinPhone" value="yes"> Ja</label>
                                    <label><input type="radio" name="editOptinPhone" value="no"> Nee</label>
                                </div>
                            </div>
                            <div class="optin-row">
                                <label class="optin-label">Direct marketing:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="editOptinPost" value="yes"> Ja</label>
                                    <label><input type="radio" name="editOptinPost" value="no"> Nee</label>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('editCustomerForm')">Annuleren</button>
                                <button type="submit" class="btn btn-primary">Opslaan</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Edit Subscription Form -->
                <div id="editSubscriptionForm" class="form-container" style="display: none;">
                    <div class="card">
                        <div class="form-header">
                            <h2>‚úèÔ∏è Abonnement Bewerken</h2>
                            <button class="btn-close" onclick="closeForm('editSubscriptionForm')">‚úï</button>
                        </div>
                        <form id="subscriptionEditForm" onsubmit="saveSubscriptionEdit(event)">
                            <input type="hidden" id="editSubId">
                            
                            <div class="info-box">
                                <strong>Let op:</strong> Wijzigingen aan het abonnement worden direct doorgevoerd.
                            </div>
                            
                            <div class="form-group">
                                <label for="editSubMagazine">Magazine *</label>
                                <select id="editSubMagazine" required>
                                    <option value="">Selecteer magazine...</option>
                                    <option value="Avrobode">Avrobode</option>
                                    <option value="Mikrogids">Mikrogids</option>
                                    <option value="Ncrvgids">Ncrvgids</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="editSubDuration">Duur & Betaling *</label>
                                <select id="editSubDuration" required>
                                    <option value="">Selecteer optie...</option>
                                    <optgroup label="Jaarlijks Betaald">
                                        <option value="1-jaar">1 jaar - ‚Ç¨52,00 per jaar</option>
                                        <option value="2-jaar">2 jaar - ‚Ç¨98,00 totaal (5% korting)</option>
                                        <option value="3-jaar">3 jaar - ‚Ç¨140,00 totaal (10% korting)</option>
                                    </optgroup>
                                    <optgroup label="Maandelijks Betaald">
                                        <option value="1-jaar-maandelijks">1 jaar - ‚Ç¨4,50 per maand (‚Ç¨54,00 totaal)</option>
                                        <option value="2-jaar-maandelijks">2 jaar - ‚Ç¨4,35 per maand (‚Ç¨104,40 totaal)</option>
                                        <option value="3-jaar-maandelijks">3 jaar - ‚Ç¨4,20 per maand (‚Ç¨151,20 totaal)</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="editSubStartDate">Startdatum *</label>
                                <input type="date" id="editSubStartDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="editSubStatus">Status *</label>
                                <select id="editSubStatus" required>
                                    <option value="active">Actief</option>
                                    <option value="paused">Gepauzeerd</option>
                                    <option value="ended">Be√´indigd</option>
                                    <option value="cancelled">Opgezegd</option>
                                </select>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('editSubscriptionForm')">Annuleren</button>
                                <button type="submit" class="btn btn-primary">Wijzigingen Opslaan</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Resend Magazine Form -->
                <div id="resendMagazineForm" class="form-container" style="display: none;">
                    <div class="card">
                        <div class="form-header">
                            <h2>üìÆ Editie Opnieuw Verzenden</h2>
                            <button class="btn-close" onclick="closeForm('resendMagazineForm')">‚úï</button>
                        </div>
                        <div class="resend-form">
                            <p class="info-text">Selecteer het abonnement waarvoor de laatste editie opnieuw moet worden verzonden.</p>
                            <div class="form-group">
                                <label for="resendSubscription">Abonnement</label>
                                <select id="resendSubscription">
                                    <option value="">Selecteer abonnement...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="resendReason">Reden</label>
                                <select id="resendReason">
                                    <option value="not_received">Niet ontvangen</option>
                                    <option value="damaged">Beschadigd</option>
                                    <option value="lost">Kwijt</option>
                                    <option value="other">Anders</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('resendMagazineForm')">Annuleren</button>
                                <button type="button" class="btn btn-primary" onclick="resendMagazine()">Editie Verzenden</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Winback Flow -->
                <div id="winbackFlow" class="form-container" style="display: none;">
                    <div class="card">
                        <div class="form-header">
                            <h2>üéØ Winback Flow - Opzegverzoek</h2>
                            <button class="btn-close" onclick="closeForm('winbackFlow')">‚úï</button>
                        </div>
                        <div class="winback-container">
                            <!-- Step Indicator -->
                            <div class="steps-indicator">
                                <div class="step active" data-step="1">
                                    <span class="step-number">1</span>
                                    <span class="step-label">Reden</span>
                                </div>
                                <div class="step" data-step="2">
                                    <span class="step-number">2</span>
                                    <span class="step-label">Aanbod</span>
                                </div>
                                <div class="step" data-step="3">
                                    <span class="step-number">3</span>
                                    <span class="step-label">Bevestiging</span>
                                </div>
                            </div>

                            <!-- Step 1: Cancellation Reason -->
                            <div id="winbackStep1" class="winback-step">
                                <h3>Waarom wilt u het abonnement opzeggen?</h3>
                                <div class="script-box">
                                    <p><strong>Script:</strong> "Het spijt me te horen dat u het abonnement wilt opzeggen. Mag ik vragen wat de belangrijkste reden is?"</p>
                                </div>
                                <div class="form-group">
                                    <label>Selecteer reden:</label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="price">
                                            <span>Te duur</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="content">
                                            <span>Inhoud niet interessant</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="delivery">
                                            <span>Leveringsproblemen</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="other">
                                            <span>Anders</span>
                                        </label>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="winbackNextStep(2)">Volgende ‚Üí</button>
                            </div>

                            <!-- Step 2: Offer -->
                            <div id="winbackStep2" class="winback-step" style="display: none;">
                                <h3>Beschikbare Winback Aanbiedingen</h3>
                                <div id="winbackOffers" class="offers-container"></div>
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="winbackPrevStep(1)">‚Üê Terug</button>
                                    <button class="btn btn-primary" onclick="winbackNextStep(3)">Aanbod Presenteren ‚Üí</button>
                                </div>
                            </div>

                            <!-- Step 3: Confirmation -->
                            <div id="winbackStep3" class="winback-step" style="display: none;">
                                <h3>Resultaat</h3>
                                <div class="script-box">
                                    <p id="winbackScript"></p>
                                </div>
                                <div class="form-group">
                                    <label>Resultaat:</label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" name="winbackResult" value="accepted">
                                            <span>‚úÖ Klant accepteert aanbod</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="winbackResult" value="declined">
                                            <span>‚ùå Klant wijst af, opzeggen</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="winbackPrevStep(2)">‚Üê Terug</button>
                                    <button class="btn btn-success" onclick="completeWinback()">Afronden</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Panel: Contact History -->
            <aside class="right-panel">
                <section class="card history-card">
                    <h2>üìã Contact Geschiedenis</h2>
                    <div id="contactHistory" class="contact-history">
                        <div class="empty-state-small">
                            <p>Selecteer een klant om geschiedenis te zien</p>
                        </div>
                    </div>
                </section>
            </aside>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="app.js"></script>
</body>
</html>