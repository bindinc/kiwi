<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klantenservice Portal - Magazine Abonnementen</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="delivery-date-picker.css">
    <link rel="stylesheet" href="article-search.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üìû Klantenservice Portal</h1>
                <div class="header-right">
                    <!-- Agent Status Widget -->
                    <div class="agent-status-widget">
                        <div class="status-indicator" id="agentStatusIndicator">
                            <span class="status-icon">‚ö´</span>
                            <span class="status-label">Offline</span>
                        </div>
                        <button class="status-dropdown-btn" onclick="toggleStatusMenu()">‚ñº</button>
                        <div class="status-menu" id="agentStatusMenu" style="display: none;">
                            <div class="status-menu-item" onclick="setAgentStatus('ready')">
                                üü¢ Beschikbaar
                            </div>
                            <div class="status-menu-item" onclick="setAgentStatus('break')">
                                üîµ Pauze
                            </div>
                            <div class="status-menu-item" onclick="setAgentStatus('offline')">
                                ‚ö´ Offline
                            </div>
                        </div>
                    </div>
                    
                    <div class="user-info">
                        <span class="agent-name">Agent: <strong id="agentName">Jan Vos</strong></span>
                        <span class="time" id="currentTime"></span>
                        <!-- Legacy Call Status Display (will be deprecated) -->
                        <span id="callStatus" class="call-status" style="display: none;"></span>
                    </div>
                    
                    <!-- New Session Info Display -->
                    <div id="sessionInfo" class="session-info" style="display: none;">
                        <div class="session-service">
                            <span class="service-icon">üìû</span>
                            <span id="sessionServiceNumber" class="service-number">AVROBODE SERVICE</span>
                        </div>
                        <div class="session-wait">
                            <span class="wait-icon">‚è≥</span>
                            <span>Gewacht: </span>
                            <span id="sessionWaitTime">0:00</span>
                        </div>
                        <div class="session-caller">
                            <span>Gesprek met: </span>
                            <span id="sessionCallerName">Anonieme Beller</span>
                        </div>
                        <div class="session-duration">
                            <span class="duration-icon">‚è±Ô∏è</span>
                            <span id="sessionDuration">00:00:00</span>
                        </div>
                        <button id="endSessionBtn" class="btn-end-session" 
                                onclick="endCallSession()" 
                                style="display: none;">
                            üìû Sessie Afsluiten
                        </button>
                    </div>
                    
                    <!-- Recording Indicator -->
                    <div class="recording-indicator" id="recordingIndicator" style="display: none;">
                        <span class="rec-icon">üî¥</span>
                        <span class="rec-text">REC</span>
                        <span class="rec-notice">Dit gesprek wordt opgenomen</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Left Panel: Search & Actions -->
            <aside class="left-panel">
                <!-- Quick Search -->
                <section class="card search-card">
                    <h2>üîç Klant Zoeken</h2>
                    <div class="search-form">
                        <div class="form-group">
                            <label for="searchName">Naam</label>
                            <input type="text" id="searchName" placeholder="Achternaam, Voornaam" onkeypress="handleSearchKeyPress(event)">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="searchPostalCode">Postcode</label>
                                <input type="text" id="searchPostalCode" placeholder="1234AB" onkeypress="handleSearchKeyPress(event)">
                            </div>
                            <div class="form-group">
                                <label for="searchHouseNumber">Huisnr.</label>
                                <input type="text" id="searchHouseNumber" placeholder="12" onkeypress="handleSearchKeyPress(event)">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="searchCustomer()">
                            <span>Zoeken</span>
                        </button>
                    </div>

                    <!-- Search Results -->
                    <div id="searchResults" class="search-results" style="display: none;">
                        <h3>Resultaten</h3>
                        <div id="resultsContainer"></div>
                    </div>
                </section>

                <!-- Quick Actions -->
                <section class="card actions-card">
                    <h2>‚ö° Snelle Acties</h2>
                    <button class="btn btn-action" onclick="showNewSubscription()">
                        <span>‚ûï Nieuw Abonnement</span>
                    </button>
                    <button class="btn btn-action" onclick="showArticleSale()">
                        <span>üõí Artikel verkoop</span>
                    </button>
                </section>
            </aside>

            <!-- Center Panel: Customer Details & Forms -->
            <main class="center-panel">
                <!-- Welcome Message -->
                <div id="welcomeMessage" class="welcome-message">
                    <div class="empty-state">
                        <span class="empty-icon">üë§</span>
                        <h2>Welkom bij Klantenservice</h2>
                        <p>Zoek een klant of start een nieuwe actie</p>
                    </div>
                </div>

                <!-- Customer Detail View -->
                <div id="customerDetail" class="customer-detail" style="display: none;">
                    <div class="card">
                        <div class="customer-header">
                            <div class="customer-info">
                                <h2 id="customerName"></h2>
                                <p class="customer-meta">
                                    <span id="customerAddress"></span> ‚Ä¢ 
                                    <span id="customerEmail"></span> ‚Ä¢ 
                                    <span id="customerPhone"></span>
                                </p>
                            </div>
                            <div class="customer-actions">
                                <button class="btn btn-small" onclick="editCustomer()">‚úèÔ∏è Bewerken</button>
                                <button id="resendMagazineBtn" class="btn btn-small btn-action-inline" onclick="showResendMagazine()">üìÆ Editie Verzenden</button>
                                <button id="winbackFlowBtn" class="btn btn-small btn-action-inline" onclick="showWinbackFlow()">üéØ Winback/Opzegging</button>
                            </div>
                        </div>

                        <!-- Subscription Overview -->
                        <div class="subscriptions-section">
                            <h3>üì∞ Abonnementen</h3>
                            <div id="subscriptionsList" class="subscriptions-list"></div>
                        </div>

                        <!-- Articles Overview -->
                        <div class="articles-section">
                            <h3>üõí Artikelen</h3>
                            <div id="articlesList" class="articles-list"></div>
                        </div>
                    </div>
                </div>

                <!-- New Subscription Form -->
                <div id="newSubscriptionForm" class="form-container" style="display: none;">
                    <div class="card onepager-container">
                        <div class="form-header">
                            <h2>‚ûï Nieuw Abonnement Aanmaken</h2>
                            <button class="btn-close" onclick="closeForm('newSubscriptionForm')">‚úï</button>
                        </div>
                        <form id="subscriptionForm" class="form-section" onsubmit="createSubscription(event)">
                            <h3 class="form-subtitle">Aanhef *</h3>
                            <div class="aanhef-row">
                                <label><input type="radio" name="subSalutation" value="Dhr." required checked> Dhr.</label>
                                <label><input type="radio" name="subSalutation" value="Mevr."> Mevr.</label>
                                <label><input type="radio" name="subSalutation" value="Anders"> Anders</label>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="subInitials" placeholder="Voorletters*" required>
                                <input type="text" id="subMiddleName" placeholder="Tussenvoegsel">
                                <input type="text" id="subLastName" placeholder="Achternaam*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="subPostalCode" placeholder="Postcode*" pattern="^[1-9][0-9]{3}[a-zA-Z]{2}$" title="Voer een geldige postcode in (bijv. 1234AB)" required>
                                <input type="text" id="subHouseNumber" placeholder="Huisnr. (en letter)*" maxlength="7" pattern="^[1-9][0-9]{0,5}[A-Z]?$" title="Voer een geldig huisnummer in (bijv. 123 of 123A)" required>
                                <input type="text" id="subHouseExt" placeholder="Toevoeging" maxlength="10">
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="subAddress" placeholder="Straat*" required>
                                <input type="text" id="subCity" placeholder="Plaats*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="tel" id="subPhone" placeholder="Telefoonnummer">
                                <input type="email" id="subEmail" placeholder="E-mailadres*" required>
                            </div>
                            
                            <h3 class="form-subtitle">Abonnementsgegevens</h3>
                            <div class="form-row">
                                <select id="subMagazine" required>
                                    <option value="">Selecteer magazine...</option>
                                    <option value="Avrobode">Avrobode</option>
                                    <option value="Mikrogids">Mikrogids</option>
                                    <option value="Ncrvgids">Ncrvgids</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <select id="subDuration" required>
                                    <option value="">Selecteer duur & betaling...</option>
                                    <optgroup label="Jaarlijks Betaald">
                                        <option value="1-jaar">1 jaar - ‚Ç¨52,00 per jaar</option>
                                        <option value="2-jaar">2 jaar - ‚Ç¨98,00 totaal (5% korting)</option>
                                        <option value="3-jaar">3 jaar - ‚Ç¨140,00 totaal (10% korting)</option>
                                    </optgroup>
                                    <optgroup label="Maandelijks Betaald">
                                        <option value="1-jaar-maandelijks">1 jaar - ‚Ç¨4,50 per maand (‚Ç¨54,00 totaal)</option>
                                        <option value="2-jaar-maandelijks">2 jaar - ‚Ç¨4,35 per maand (‚Ç¨104,40 totaal)</option>
                                        <option value="3-jaar-maandelijks">3 jaar - ‚Ç¨4,20 per maand (‚Ç¨151,20 totaal)</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <input type="date" id="subStartDate" required>
                            </div>
                            
                            <h3 class="form-subtitle">Betaalmethode *</h3>
                            <div class="form-row">
                                <div class="payment-methods">
                                    <div class="payment-option">
                                        <input type="radio" id="subPaymentAuto" name="subPayment" value="automatisch" checked>
                                        <label for="subPaymentAuto">
                                            <span class="payment-icon">
                                                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" fill="none">
                                                    <rect x="3" y="5" width="18" height="14" rx="2" stroke-width="2"/>
                                                    <line x1="3" y1="10" x2="21" y2="10" stroke-width="2"/>
                                                </svg>
                                            </span>
                                            <span class="payment-text">Automatisch incasso</span>
                                        </label>
                                        <div class="additional-input">
                                            <input type="text" id="subIBAN" placeholder="IBAN rekeningnummer" 
                                                pattern="^(NL[0-9]{2}[A-Z]{4}[0-9]{10}|BE[0-9]{2}[0-9]{12})$" 
                                                title="Vul hier een geldig IBAN nummer in. Alleen Nederlandse (NL) en Belgische (BE) rekeningen worden ondersteund.">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h3 class="form-subtitle">Marketing voorkeuren</h3>
                            <div class="optin-row">
                                <label class="optin-label">E-mail contact:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="subOptinEmail" value="yes" checked> Ja</label>
                                    <label><input type="radio" name="subOptinEmail" value="no"> Nee</label>
                                </div>
                            </div>
                            <div class="optin-row">
                                <label class="optin-label">Telefonisch contact:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="subOptinPhone" value="yes" checked> Ja</label>
                                    <label><input type="radio" name="subOptinPhone" value="no"> Nee</label>
                                </div>
                            </div>
                            <div class="optin-row">
                                <label class="optin-label">Direct marketing:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="subOptinPost" value="yes" checked> Ja</label>
                                    <label><input type="radio" name="subOptinPost" value="no"> Nee</label>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('newSubscriptionForm')">Annuleren</button>
                                <button type="submit" class="btn btn-primary">Abonnement Aanmaken</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Article Sale Form -->
                <div id="articleSaleForm" class="form-container" style="display: none;">
                    <div class="card onepager-container article-sale-container">
                        <div class="form-header">
                            <h2>üõí Artikel Verkoop</h2>
                            <button class="btn-close" onclick="closeForm('articleSaleForm')">‚úï</button>
                        </div>
                        <form id="articleForm" class="form-section" onsubmit="createArticleSale(event)">
                            <div class="article-sale-columns">
                                <div class="article-sale-left">
                            <h3 class="form-subtitle">Klantgegevens *</h3>
                            <div class="aanhef-row">
                                <label><input type="radio" name="articleSalutation" value="Dhr." required checked> Dhr.</label>
                                <label><input type="radio" name="articleSalutation" value="Mevr."> Mevr.</label>
                                <label><input type="radio" name="articleSalutation" value="Anders"> Anders</label>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="articleInitials" placeholder="Voorletters*" required>
                                <input type="text" id="articleMiddleName" placeholder="Tussenvoegsel">
                                <input type="text" id="articleLastName" placeholder="Achternaam*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="articlePostalCode" placeholder="Postcode*" pattern="^[1-9][0-9]{3}[a-zA-Z]{2}$" title="Voer een geldige postcode in (bijv. 1234AB)" required>
                                <input type="text" id="articleHouseNumber" placeholder="Huisnr. (en letter)*" maxlength="7" pattern="^[1-9][0-9]{0,5}[A-Z]?$" title="Voer een geldig huisnummer in (bijv. 123 of 123A)" required>
                                <input type="text" id="articleHouseExt" placeholder="Toevoeging" maxlength="10">
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="articleAddress" placeholder="Straat*" required>
                                <input type="text" id="articleCity" placeholder="Plaats*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="tel" id="articlePhone" placeholder="Telefoonnummer*" required>
                                <input type="email" id="articleEmail" placeholder="E-mailadres*" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="articleDesiredDelivery">Gewenste leverdatum *</label>
                                    <div id="deliveryDatePickerContainer" class="delivery-date-picker-container">
                                        <input type="hidden" id="articleDesiredDelivery" required>
                                        <div class="delivery-date-display" id="deliveryDateDisplay">
                                            Selecteer een datum...
                                        </div>
                                        <div class="delivery-calendar" id="deliveryCalendar" style="display: none;">
                                            <!-- Calendar generated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="articleNotes">Bezorginstructies</label>
                                    <div class="delivery-remarks-shortcuts">
                                        <button type="button" class="remark-shortcut" 
                                                onclick="addDeliveryRemark('Bezorgen bij de buren indien niet thuis')">
                                            üë• Bij buren
                                        </button>
                                        <button type="button" class="remark-shortcut" 
                                                onclick="addDeliveryRemark('Achterdeur of zijdeur gebruiken')">
                                            üö™ Achterdeur
                                        </button>
                                        <button type="button" class="remark-shortcut" 
                                                onclick="addDeliveryRemark('Niet v√≥√≥r 12:00 uur bezorgen')">
                                            üïê Na 12:00
                                        </button>
                                        <button type="button" class="remark-shortcut" 
                                                onclick="addDeliveryRemark('Bellen voor levering')">
                                            üìû Bel eerst
                                        </button>
                                        <button type="button" class="remark-shortcut" 
                                                onclick="addDeliveryRemark('Pakketbrievenbus aanwezig')">
                                            üìÆ Brievenbus
                                        </button>
                                        <button type="button" class="remark-shortcut" 
                                                onclick="addDeliveryRemark('Voorzichtig behandelen - breekbaar')">
                                            ‚ö†Ô∏è Breekbaar
                                        </button>
                                    </div>
                                    <textarea id="articleNotes" placeholder="Bezorginstructies of opmerkingen (optioneel)" rows="3"></textarea>
                                </div>
                            </div>
                            
                            <h3 class="form-subtitle">Betaalmethode *</h3>
                            <div class="form-row">
                                <div class="payment-methods">
                                    <div class="payment-option">
                                        <input type="radio" id="articlePaymentIdeal" name="articlePayment" value="iDEAL" checked>
                                        <label for="articlePaymentIdeal">
                                            <span class="payment-icon">üí≥</span>
                                            <span class="payment-text">iDEAL (Klant ontvangt buckaroo checkout link per e-mail)</span>
                                        </label>
                                    </div>
                                    <div class="payment-option">
                                        <input type="radio" id="articlePaymentTransfer" name="articlePayment" value="Bankoverschrijving">
                                        <label for="articlePaymentTransfer">
                                            <span class="payment-icon">üè¶</span>
                                            <span class="payment-text">Bankoverschrijving (klant ontvangt factuur per post)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('articleSaleForm')">Annuleren</button>
                                <button type="submit" class="btn btn-primary">Bestelling Plaatsen</button>
                            </div>                            
                                </div>
                                <div class="article-sale-right">
            <h3 class="form-subtitle">Artikelgegevens</h3>
            <div class="form-group">
                <label for="articleSearch">Artikel *</label>
                <div class="article-selector">
                    <input type="text" 
                           id="articleSearch" 
                           placeholder="Type artikel naam of code..." 
                           autocomplete="off"
                           oninput="filterArticles(this.value)">
                    <input type="hidden" id="articleName">
                    <div class="article-dropdown" id="articleDropdown" style="display: none;">
                        <!-- Dropdown populated by JavaScript -->
                    </div>
                </div>
            </div>                            <div class="form-row">
                                <div class="form-group">
                                    <label for="articleQuantity">Aantal</label>
                                    <input type="number" id="articleQuantity" min="1" value="1" required onchange="updateArticlePrice()">
                                </div>
                                <div class="form-group">
                                    <label for="articlePrice">Prijs per stuk</label>
                                    <input type="text" id="articlePrice" readonly placeholder="‚Ç¨0,00">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <button type="button" class="btn btn-success btn-block" onclick="addArticleToOrder()">
                                    ‚ûï Artikel Toevoegen aan Bestelling
                                </button>
                            </div>
                            
                            <!-- Order Items List -->
                            <div id="orderItemsSection" class="order-items-section" style="display: none;">
                                <h3 class="form-subtitle">üìã Bestelling Overzicht</h3>
                                <div id="orderItemsList" class="order-items-list">
                                    <!-- Items will be added dynamically -->
                                </div>
                                
                                <!-- Coupon Code Section -->
                                <div class="coupon-section">
                                    <label for="couponCode">Kortingscode</label>
                                    <div class="coupon-input-group">
                                        <input type="text" 
                                               id="couponCode" 
                                               placeholder="Voer kortingscode in..." 
                                               maxlength="20"
                                               onkeydown="if(event.key==='Enter') { event.preventDefault(); applyCoupon(); }">
                                        <button type="button" 
                                                class="btn btn-secondary btn-apply-coupon" 
                                                onclick="applyCoupon()">
                                            Toepassen
                                        </button>
                                    </div>
                                    <div id="couponMessage" class="coupon-message"></div>
                                </div>
                                
                                <div class="order-summary">
                                    <div class="order-summary-row">
                                        <span>Subtotaal:</span>
                                        <span id="orderSubtotal">‚Ç¨0,00</span>
                                    </div>
                                    <div id="discountsBreakdown" class="discounts-breakdown" style="display: none;">
                                        <!-- Discount items will be added dynamically -->
                                    </div>
                                    <div class="order-summary-row total-row">
                                        <span><strong>Totaal:</strong></span>
                                        <span id="orderTotal"><strong>‚Ç¨0,00</strong></span>
                                    </div>
                                </div>
                            </div>
                                </div>
                            </div>
                            
                        </form>
                    </div>
                </div>

                <!-- Edit Customer Form -->
                <div id="editCustomerForm" class="form-container" style="display: none;">
                    <div class="card onepager-container">
                        <div class="form-header">
                            <h2>‚úèÔ∏è Klantgegevens Bewerken</h2>
                            <button class="btn-close" onclick="closeForm('editCustomerForm')">‚úï</button>
                        </div>
                        <form id="customerEditForm" class="form-section" onsubmit="saveCustomerEdit(event)">
                            <input type="hidden" id="editCustomerId">
                            
                            <h3 class="form-subtitle">Aanhef *</h3>
                            <div class="aanhef-row">
                                <label><input type="radio" name="editSalutation" value="Dhr." required> Dhr.</label>
                                <label><input type="radio" name="editSalutation" value="Mevr."> Mevr.</label>
                                <label><input type="radio" name="editSalutation" value="Anders"> Anders</label>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="editInitials" placeholder="Voorletters*" required>
                                <input type="text" id="editMiddleName" placeholder="Tussenvoegsel">
                                <input type="text" id="editLastName" placeholder="Achternaam*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="editPostalCode" placeholder="Postcode*" pattern="^[1-9][0-9]{3}[a-zA-Z]{2}$" title="Voer een geldige postcode in (bijv. 1234AB)" required>
                                <input type="text" id="editHouseNumber" placeholder="Huisnr. (en letter)*" maxlength="7" pattern="^[1-9][0-9]{0,5}[A-Z]?$" title="Voer een geldig huisnummer in" required>
                                <input type="text" id="editHouseExt" placeholder="Toevoeging" maxlength="10">
                            </div>
                            
                            <div class="form-row">
                                <input type="text" id="editAddress" placeholder="Straat*" required>
                                <input type="text" id="editCity" placeholder="Plaats*" required>
                            </div>
                            
                            <div class="form-row">
                                <input type="tel" id="editPhone" placeholder="Telefoonnummer">
                                <input type="email" id="editEmail" placeholder="E-mailadres*" required>
                            </div>
                            
                            <h3 class="form-subtitle">Marketing voorkeuren</h3>
                            <div class="optin-row">
                                <label class="optin-label">E-mail contact:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="editOptinEmail" value="yes"> Ja</label>
                                    <label><input type="radio" name="editOptinEmail" value="no"> Nee</label>
                                </div>
                            </div>
                            <div class="optin-row">
                                <label class="optin-label">Telefonisch contact:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="editOptinPhone" value="yes"> Ja</label>
                                    <label><input type="radio" name="editOptinPhone" value="no"> Nee</label>
                                </div>
                            </div>
                            <div class="optin-row">
                                <label class="optin-label">Direct marketing:</label>
                                <div class="optin-options">
                                    <label><input type="radio" name="editOptinPost" value="yes"> Ja</label>
                                    <label><input type="radio" name="editOptinPost" value="no"> Nee</label>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('editCustomerForm')">Annuleren</button>
                                <button type="submit" class="btn btn-primary">Opslaan</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Edit Subscription Form -->
                <div id="editSubscriptionForm" class="form-container" style="display: none;">
                    <div class="card">
                        <div class="form-header">
                            <h2>‚úèÔ∏è Abonnement Bewerken</h2>
                            <button class="btn-close" onclick="closeForm('editSubscriptionForm')">‚úï</button>
                        </div>
                        <form id="subscriptionEditForm" onsubmit="saveSubscriptionEdit(event)">
                            <input type="hidden" id="editSubId">
                            
                            <div class="info-box">
                                <strong>Let op:</strong> Wijzigingen aan het abonnement worden direct doorgevoerd.
                            </div>
                            
                            <div class="form-group">
                                <label for="editSubMagazine">Magazine *</label>
                                <select id="editSubMagazine" required>
                                    <option value="">Selecteer magazine...</option>
                                    <option value="Avrobode">Avrobode</option>
                                    <option value="Mikrogids">Mikrogids</option>
                                    <option value="Ncrvgids">Ncrvgids</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="editSubDuration">Duur & Betaling *</label>
                                <select id="editSubDuration" required>
                                    <option value="">Selecteer optie...</option>
                                    <optgroup label="Jaarlijks Betaald">
                                        <option value="1-jaar">1 jaar - ‚Ç¨52,00 per jaar</option>
                                        <option value="2-jaar">2 jaar - ‚Ç¨98,00 totaal (5% korting)</option>
                                        <option value="3-jaar">3 jaar - ‚Ç¨140,00 totaal (10% korting)</option>
                                    </optgroup>
                                    <optgroup label="Maandelijks Betaald">
                                        <option value="1-jaar-maandelijks">1 jaar - ‚Ç¨4,50 per maand (‚Ç¨54,00 totaal)</option>
                                        <option value="2-jaar-maandelijks">2 jaar - ‚Ç¨4,35 per maand (‚Ç¨104,40 totaal)</option>
                                        <option value="3-jaar-maandelijks">3 jaar - ‚Ç¨4,20 per maand (‚Ç¨151,20 totaal)</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="editSubStartDate">Startdatum *</label>
                                <input type="date" id="editSubStartDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="editSubStatus">Status *</label>
                                <select id="editSubStatus" required>
                                    <option value="active">Actief</option>
                                    <option value="paused">Gepauzeerd</option>
                                    <option value="ended">Be√´indigd</option>
                                    <option value="cancelled">Opgezegd</option>
                                </select>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('editSubscriptionForm')">Annuleren</button>
                                <button type="submit" class="btn btn-primary">Wijzigingen Opslaan</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Resend Magazine Form -->
                <div id="resendMagazineForm" class="form-container" style="display: none;">
                    <div class="card">
                        <div class="form-header">
                            <h2>üìÆ Editie Opnieuw Verzenden</h2>
                            <button class="btn-close" onclick="closeForm('resendMagazineForm')">‚úï</button>
                        </div>
                        <div class="resend-form">
                            <p class="info-text">Selecteer het abonnement waarvoor de laatste editie opnieuw moet worden verzonden.</p>
                            <div class="form-group">
                                <label for="resendSubscription">Abonnement</label>
                                <select id="resendSubscription">
                                    <option value="">Selecteer abonnement...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="resendReason">Reden</label>
                                <select id="resendReason">
                                    <option value="not_received">Niet ontvangen</option>
                                    <option value="damaged">Beschadigd</option>
                                    <option value="lost">Kwijt</option>
                                    <option value="other">Anders</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('resendMagazineForm')">Annuleren</button>
                                <button type="button" class="btn btn-primary" onclick="resendMagazine()">Editie Verzenden</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Restitution Transfer Form -->
                <div id="restitutionTransferForm" class="form-container" style="display: none;">
                    <div class="card">
                        <div class="form-header">
                            <h2 id="restitutionTransferTitle">üîÑ Abonnement Overzetten</h2>
                            <button class="btn-close" onclick="closeForm('restitutionTransferForm')">‚úï</button>
                        </div>
                        <form id="restitutionTransferFormElement" onsubmit="completeRestitutionTransfer(event)">
                            <div class="info-box" style="background-color: rgba(239, 68, 68, 0.1); border-color: #ef4444;">
                                <strong>Let op:</strong> Overleden personen kunnen geen actieve abonnementen hebben. Het abonnement moet worden overgezet naar een andere persoon.
                            </div>
                            
                            <h3 class="form-subtitle">Nieuwe abonnee gegevens</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="restitutionTransferSalutation">Aanhef *</label>
                                    <select id="restitutionTransferSalutation" class="form-control" required>
                                        <option value="Dhr.">Dhr.</option>
                                        <option value="Mevr.">Mevr.</option>
                                        <option value="Anders">Anders</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="restitutionTransferFirstName">Voornaam *</label>
                                    <input type="text" id="restitutionTransferFirstName" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="restitutionTransferMiddleName">Tussenvoegsel</label>
                                    <input type="text" id="restitutionTransferMiddleName" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="restitutionTransferLastName">Achternaam *</label>
                                    <input type="text" id="restitutionTransferLastName" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="restitutionTransferEmail">E-mail *</label>
                                <input type="email" id="restitutionTransferEmail" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="restitutionTransferPhone">Telefoonnummer *</label>
                                <input type="tel" id="restitutionTransferPhone" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="restitutionTransferSameAddress" onchange="toggleRestitutionTransferAddress()">
                                    Zelfde adres als originele abonnee
                                </label>
                            </div>
                            
                            <div id="restitutionTransferAddressFields">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="restitutionTransferPostalCode">Postcode *</label>
                                        <input type="text" id="restitutionTransferPostalCode" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="restitutionTransferHouseNumber">Huisnummer *</label>
                                        <input type="text" id="restitutionTransferHouseNumber" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="restitutionTransferAddress">Straat en nummer *</label>
                                    <input type="text" id="restitutionTransferAddress" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="restitutionTransferCity">Plaats *</label>
                                    <input type="text" id="restitutionTransferCity" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeForm('restitutionTransferForm')">Annuleren</button>
                                <button type="submit" class="btn btn-success">Abonnement Overzetten</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Winback Flow -->
                <div id="winbackFlow" class="form-container" style="display: none;">
                    <div class="card">
                        <div class="form-header">
                            <h2>üéØ Winback/Opzegging Flow</h2>
                            <button class="btn-close" onclick="closeForm('winbackFlow')">‚úï</button>
                        </div>
                        <div class="winback-container">
                            <!-- Step Indicator -->
                            <div class="steps-indicator">
                                <div class="step active" data-step="1">
                                    <span class="step-number">1</span>
                                    <span class="step-label">Reden</span>
                                </div>
                                <div class="step" data-step="2">
                                    <span class="step-number">2</span>
                                    <span class="step-label">Aanbod</span>
                                </div>
                                <div class="step" data-step="3">
                                    <span class="step-number">3</span>
                                    <span class="step-label">Bevestiging</span>
                                </div>
                            </div>

                            <!-- Step 1: Cancellation Reason -->
                            <div id="winbackStep1" class="winback-step">
                                <h3>Waarom wilt u het abonnement opzeggen?</h3>
                                <div class="script-box">
                                    <p><strong>Script:</strong> "Het spijt me te horen dat u het abonnement wilt opzeggen. Mag ik vragen wat de belangrijkste reden is?"</p>
                                </div>
                                <div class="form-group">
                                    <label>Selecteer reden:</label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="price">
                                            <span>Te duur</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="content">
                                            <span>Inhoud niet interessant</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="delivery">
                                            <span>Leveringsproblemen</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="deceased">
                                            <span>Overleden</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="cancelReason" value="other">
                                            <span>Anders</span>
                                        </label>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="winbackNextStep(2)">Volgende ‚Üí</button>
                            </div>

                            <!-- Step 1b: Deceased - Select Subscriptions -->
                            <div id="winbackStep1b" class="winback-step" style="display: none;">
                                <h3>Abonnementen bij Overlijden</h3>
                                <div class="script-box">
                                    <p><strong>Script:</strong> "Wat vervelend om te horen. Ik zie dat er <span id="deceasedSubCount"></span> actieve abonnement(en) zijn. Voor elk abonnement kunt u aangeven wat u wilt doen."</p>
                                </div>
                                <div id="deceasedSubscriptionsList" class="deceased-subscriptions-list">
                                    <!-- Subscriptions will be dynamically inserted here -->
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="winbackPrevStep(1)">‚Üê Terug</button>
                                    <button class="btn btn-primary" onclick="processDeceasedSubscriptions()">Verwerken ‚Üí</button>
                                </div>
                            </div>

                            <!-- Step 1c: Cancel with Refund -->
                            <div id="winbackStep1c" class="winback-step" style="display: none;">
                                <h3>Opzeggen met Restitutie</h3>
                                <div id="refundSubscriptionsList" class="info-box">
                                    <!-- Will show which subscriptions are being cancelled -->
                                </div>
                                <div class="form-group">
                                    <label for="refundEmail">E-mailadres voor bevestiging:</label>
                                    <input type="email" id="refundEmail" class="form-control" placeholder="naam@email.nl">
                                    <small class="form-text">De opzegbevestiging en restitutie-informatie wordt naar dit adres gestuurd</small>
                                </div>
                                <div class="form-group">
                                    <label for="refundNotes">Notities (optioneel):</label>
                                    <textarea id="refundNotes" class="form-control" rows="3" placeholder="Bijv. rekeningnummer voor restitutie, contactpersoon, etc."></textarea>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="winbackPrevStep('1b')">‚Üê Terug</button>
                                    <button class="btn btn-danger" onclick="completeAllDeceasedActions()">Verwerken</button>
                                </div>
                            </div>

                            <!-- Step 1d: Transfer Subscription -->
                            <div id="winbackStep1d" class="winback-step" style="display: none;">
                                <h3>Abonnement(en) Overzetten</h3>
                                <div id="transferSubscriptionsList" class="info-box">
                                    <!-- Will show which subscriptions are being transferred -->
                                </div>
                                
                                <!-- Unified Customer Form -->
                                <div id="transferCustomerForm"></div>
                                
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="winbackPrevStep('1b')">‚Üê Terug</button>
                                    <button class="btn btn-success" onclick="completeAllDeceasedActions()">Verwerken</button>
                                </div>
                            </div>
                            
                            <!-- Step 1e: Combined Form (Transfer + Refund) -->
                            <div id="winbackStep1e" class="winback-step" style="display: none;">
                                <h3>Alle Abonnementen Verwerken</h3>
                                
                                <div id="combinedTransferList" class="info-box">
                                    <!-- Transfer subscriptions -->
                                </div>
                                
                                <h4>Nieuwe abonnee gegevens</h4>
                                
                                <!-- Unified Customer Form -->
                                <div id="transfer2CustomerForm"></div>
                                
                                <div id="combinedRefundList" class="info-box" style="margin-top: 2rem;">
                                    <!-- Refund subscriptions -->
                                </div>
                                
                                <h4>Restitutie gegevens</h4>
                                <div class="form-group">
                                    <label for="refundEmail2">E-mailadres voor bevestiging:</label>
                                    <input type="email" id="refundEmail2" class="form-control" placeholder="naam@email.nl">
                                    <small class="form-text">De opzegbevestiging en restitutie-informatie wordt naar dit adres gestuurd</small>
                                </div>
                                <div class="form-group">
                                    <label for="refundNotes2">Notities (optioneel):</label>
                                    <textarea id="refundNotes2" class="form-control" rows="3" placeholder="Bijv. rekeningnummer voor restitutie, contactpersoon, etc."></textarea>
                                </div>
                                
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="winbackPrevStep('1b')">‚Üê Terug</button>
                                    <button class="btn btn-success" onclick="completeAllDeceasedActions()">Alles Verwerken</button>
                                </div>
                            </div>

                            <!-- Step 2: Offer -->
                            <div id="winbackStep2" class="winback-step" style="display: none;">
                                <h3>Beschikbare Winback Aanbiedingen</h3>
                                <div id="winbackOffers" class="offers-container"></div>
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="winbackPrevStep(1)">‚Üê Terug</button>
                                    <button class="btn btn-primary" onclick="winbackNextStep(3)">Aanbod Presenteren ‚Üí</button>
                                </div>
                            </div>

                            <!-- Step 3: Confirmation -->
                            <div id="winbackStep3" class="winback-step" style="display: none;">
                                <h3>Resultaat</h3>
                                <div class="script-box">
                                    <p id="winbackScript"></p>
                                </div>
                                <div class="form-group">
                                    <label>Resultaat:</label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" name="winbackResult" value="accepted">
                                            <span>‚úÖ Klant accepteert aanbod</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="winbackResult" value="declined">
                                            <span>‚ùå Klant wijst af, opzeggen</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="winbackPrevStep(2)">‚Üê Terug</button>
                                    <button class="btn btn-success" onclick="completeWinback()">Afronden</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Panel: Contact History -->
            <aside class="right-panel">
                <section class="card history-card">
                    <h2>üìã Contact Geschiedenis</h2>
                    <div id="contactHistory" class="contact-history">
                        <div class="empty-state-small">
                            <p>Selecteer een klant om geschiedenis te zien</p>
                        </div>
                    </div>
                </section>
            </aside>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Edit Delivery Remarks Modal -->
    <div id="editDeliveryRemarksModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì¶ Bezorgvoorkeuren bewerken</h2>
                <button class="modal-close" onclick="closeEditRemarksModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Klant: <strong id="editRemarksCustomerName"></strong></p>
                
                <!-- Quick selection buttons -->
                <div class="delivery-remarks-shortcuts">
                    <button type="button" class="remark-shortcut" 
                            onclick="addDeliveryRemarkToModal('Bezorgen bij de buren indien niet thuis')">
                        üë• Bij buren
                    </button>
                    <button type="button" class="remark-shortcut" 
                            onclick="addDeliveryRemarkToModal('Achterdeur of zijdeur gebruiken')">
                        üö™ Achterdeur
                    </button>
                    <button type="button" class="remark-shortcut" 
                            onclick="addDeliveryRemarkToModal('Niet v√≥√≥r 12:00 uur bezorgen')">
                        üïê Na 12:00
                    </button>
                    <button type="button" class="remark-shortcut" 
                            onclick="addDeliveryRemarkToModal('Bellen voor levering')">
                        üìû Bel eerst
                    </button>
                    <button type="button" class="remark-shortcut" 
                            onclick="addDeliveryRemarkToModal('Pakketbrievenbus aanwezig')">
                        üìÆ Brievenbus
                    </button>
                    <button type="button" class="remark-shortcut" 
                            onclick="addDeliveryRemarkToModal('Voorzichtig behandelen - breekbaar')">
                        ‚ö†Ô∏è Breekbaar
                    </button>
                </div>
                
                <label for="editCustomerDeliveryRemarks">Standaard bezorginstructies</label>
                <textarea id="editCustomerDeliveryRemarks" 
                          rows="4" 
                          placeholder="Voer bezorginstructies in..."></textarea>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeEditRemarksModal()">Annuleren</button>
                    <button class="btn btn-primary" onclick="saveDeliveryRemarks()">
                        Opslaan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Mode Modal -->
    <div id="debugModal" class="modal">
        <div class="modal-content debug-modal-content">
            <div class="modal-header">
                <h2>üîß Debug Mode</h2>
                <button class="modal-close" onclick="closeDebugModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- PHASE 3: Call Simulation Section -->
                <div class="debug-section">
                    <h3>üìû Call Simulation</h3>
                    
                    <div class="debug-row">
                        <label>Service Nummer:</label>
                        <select id="debugServiceNumber">
                            <option value="AVROBODE">Avrobode Service</option>
                            <option value="MIKROGIDS">Mikrogids Service</option>
                            <option value="NCRVGIDS">NcrvGids Service</option>
                            <option value="ALGEMEEN">Algemeen Service</option>
                        </select>
                    </div>
                    
                    <div class="debug-row">
                        <label>Wachttijd simulatie:</label>
                        <select id="debugWaitTime">
                            <option value="random">Willekeurig (15-90 sec)</option>
                            <option value="15">15 seconden</option>
                            <option value="30">30 seconden</option>
                            <option value="60">1 minuut</option>
                            <option value="120">2 minuten</option>
                            <option value="300">5 minuten</option>
                        </select>
                    </div>
                    
                    <div class="debug-row">
                        <label>Beller type:</label>
                        <select id="debugCallerType" onchange="toggleKnownCallerSelect()">
                            <option value="anonymous">Anonieme Beller</option>
                            <option value="known">Bekende Klant</option>
                        </select>
                    </div>
                    
                    <div id="debugKnownCallerSelect" class="debug-row" style="display: none;">
                        <label>Selecteer klant:</label>
                        <select id="debugKnownCustomer">
                            <!-- Populated by JavaScript -->
                        </select>
                    </div>
                    
                    <div class="debug-actions">
                        <button class="btn btn-success btn-block" onclick="debugStartCall()">
                            ÔøΩ Start Gesprek Simulatie
                        </button>
                        <button id="debugEndCallBtn" 
                                class="btn btn-danger btn-block" 
                                onclick="debugEndCall()"
                                style="display: none;">
                            ‚ùå Be√´indig Telefoongesprek
                        </button>
                    </div>
                </div>
                
                <div class="debug-section">
                    <h3>System Reset</h3>
                    <button class="btn btn-danger btn-block" onclick="fullReset()">
                        üóëÔ∏è Purge Localstorage & Full Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="delivery-date-picker.js"></script>
    <script src="article-search.js"></script>
    <script src="app.js"></script>
</body>
</html>